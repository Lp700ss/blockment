{"ast":null,"code":"import { __awaiter, __generator } from \"tslib\"; // eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\nexport function withTimeout(sync, timeout, timeoutError) {\n  var _this = this;\n\n  if (timeoutError === void 0) {\n    timeoutError = new Error('timeout');\n  }\n\n  return {\n    acquire: function () {\n      return new Promise(function (resolve, reject) {\n        return __awaiter(_this, void 0, void 0, function () {\n          var isTimeout, ticket, release;\n          return __generator(this, function (_a) {\n            switch (_a.label) {\n              case 0:\n                isTimeout = false;\n                setTimeout(function () {\n                  isTimeout = true;\n                  reject(timeoutError);\n                }, timeout);\n                return [4\n                /*yield*/\n                , sync.acquire()];\n\n              case 1:\n                ticket = _a.sent();\n\n                if (isTimeout) {\n                  release = Array.isArray(ticket) ? ticket[1] : ticket;\n                  release();\n                } else {\n                  resolve(ticket);\n                }\n\n                return [2\n                /*return*/\n                ];\n            }\n          });\n        });\n      });\n    },\n    runExclusive: function (callback) {\n      return __awaiter(this, void 0, void 0, function () {\n        var release, ticket;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              release = function () {\n                return undefined;\n              };\n\n              _a.label = 1;\n\n            case 1:\n              _a.trys.push([1,, 7, 8]);\n\n              return [4\n              /*yield*/\n              , this.acquire()];\n\n            case 2:\n              ticket = _a.sent();\n              if (!Array.isArray(ticket)) return [3\n              /*break*/\n              , 4];\n              release = ticket[1];\n              return [4\n              /*yield*/\n              , callback(ticket[0])];\n\n            case 3:\n              return [2\n              /*return*/\n              , _a.sent()];\n\n            case 4:\n              release = ticket;\n              return [4\n              /*yield*/\n              , callback()];\n\n            case 5:\n              return [2\n              /*return*/\n              , _a.sent()];\n\n            case 6:\n              return [3\n              /*break*/\n              , 8];\n\n            case 7:\n              release();\n              return [7\n              /*endfinally*/\n              ];\n\n            case 8:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    },\n    release: function () {\n      sync.release();\n    },\n    isLocked: function () {\n      return sync.isLocked();\n    }\n  };\n}","map":{"version":3,"names":["__awaiter","__generator","withTimeout","sync","timeout","timeoutError","_this","Error","acquire","Promise","resolve","reject","isTimeout","ticket","release","_a","label","setTimeout","sent","Array","isArray","runExclusive","callback","undefined","trys","push","isLocked"],"sources":["E:/intoweb3/NBlockment/blockment/node_modules/async-mutex/es6/withTimeout.js"],"sourcesContent":["import { __awaiter, __generator } from \"tslib\";\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\nexport function withTimeout(sync, timeout, timeoutError) {\n    var _this = this;\n    if (timeoutError === void 0) { timeoutError = new Error('timeout'); }\n    return {\n        acquire: function () {\n            return new Promise(function (resolve, reject) { return __awaiter(_this, void 0, void 0, function () {\n                var isTimeout, ticket, release;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            isTimeout = false;\n                            setTimeout(function () {\n                                isTimeout = true;\n                                reject(timeoutError);\n                            }, timeout);\n                            return [4 /*yield*/, sync.acquire()];\n                        case 1:\n                            ticket = _a.sent();\n                            if (isTimeout) {\n                                release = Array.isArray(ticket) ? ticket[1] : ticket;\n                                release();\n                            }\n                            else {\n                                resolve(ticket);\n                            }\n                            return [2 /*return*/];\n                    }\n                });\n            }); });\n        },\n        runExclusive: function (callback) {\n            return __awaiter(this, void 0, void 0, function () {\n                var release, ticket;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            release = function () { return undefined; };\n                            _a.label = 1;\n                        case 1:\n                            _a.trys.push([1, , 7, 8]);\n                            return [4 /*yield*/, this.acquire()];\n                        case 2:\n                            ticket = _a.sent();\n                            if (!Array.isArray(ticket)) return [3 /*break*/, 4];\n                            release = ticket[1];\n                            return [4 /*yield*/, callback(ticket[0])];\n                        case 3: return [2 /*return*/, _a.sent()];\n                        case 4:\n                            release = ticket;\n                            return [4 /*yield*/, callback()];\n                        case 5: return [2 /*return*/, _a.sent()];\n                        case 6: return [3 /*break*/, 8];\n                        case 7:\n                            release();\n                            return [7 /*endfinally*/];\n                        case 8: return [2 /*return*/];\n                    }\n                });\n            });\n        },\n        release: function () {\n            sync.release();\n        },\n        isLocked: function () { return sync.isLocked(); },\n    };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}