{"ast":null,"code":"'use strict';\n\nconst uuid = require('uuid').v4;\n\nconst generateRequest = require('../../generateRequest');\n/**\n * Constructor for a Jayson Browser Client that does not depend any node.js core libraries\n * @class ClientBrowser\n * @param {Function} callServer Method that calls the server, receives the stringified request and a regular node-style callback\n * @param {Object} [options]\n * @param {Function} [options.reviver] Reviver function for JSON\n * @param {Function} [options.replacer] Replacer function for JSON\n * @param {Number} [options.version=2] JSON-RPC version to use (1|2)\n * @param {Function} [options.generator] Function to use for generating request IDs\n *  @param {Boolean} [options.notificationIdNull=false] When true, version 2 requests will set id to null instead of omitting it\n * @return {ClientBrowser}\n */\n\n\nconst ClientBrowser = function (callServer, options) {\n  if (!(this instanceof ClientBrowser)) {\n    return new ClientBrowser(callServer, options);\n  }\n\n  if (!options) {\n    options = {};\n  }\n\n  this.options = {\n    reviver: typeof options.reviver !== 'undefined' ? options.reviver : null,\n    replacer: typeof options.replacer !== 'undefined' ? options.replacer : null,\n    generator: typeof options.generator !== 'undefined' ? options.generator : function () {\n      return uuid();\n    },\n    version: typeof options.version !== 'undefined' ? options.version : 2,\n    notificationIdNull: typeof options.notificationIdNull === 'boolean' ? options.notificationIdNull : false\n  };\n  this.callServer = callServer;\n};\n\nmodule.exports = ClientBrowser;\n/**\n *  Creates a request and dispatches it if given a callback.\n *  @param {String|Array} method A batch request if passed an Array, or a method name if passed a String\n *  @param {Array|Object} [params] Parameters for the method\n *  @param {String|Number} [id] Optional id. If undefined an id will be generated. If null it creates a notification request\n *  @param {Function} [callback] Request callback. If specified, executes the request rather than only returning it.\n *  @throws {TypeError} Invalid parameters\n *  @return {Object} JSON-RPC 1.0 or 2.0 compatible request\n */\n\nClientBrowser.prototype.request = function (method, params, id, callback) {\n  const self = this;\n  let request = null; // is this a batch request?\n\n  const isBatch = Array.isArray(method) && typeof params === 'function';\n\n  if (this.options.version === 1 && isBatch) {\n    throw new TypeError('JSON-RPC 1.0 does not support batching');\n  } // is this a raw request?\n\n\n  const isRaw = !isBatch && method && typeof method === 'object' && typeof params === 'function';\n\n  if (isBatch || isRaw) {\n    callback = params;\n    request = method;\n  } else {\n    if (typeof id === 'function') {\n      callback = id; // specifically undefined because \"null\" is a notification request\n\n      id = undefined;\n    }\n\n    const hasCallback = typeof callback === 'function';\n\n    try {\n      request = generateRequest(method, params, id, {\n        generator: this.options.generator,\n        version: this.options.version,\n        notificationIdNull: this.options.notificationIdNull\n      });\n    } catch (err) {\n      if (hasCallback) {\n        return callback(err);\n      }\n\n      throw err;\n    } // no callback means we should just return a raw request\n\n\n    if (!hasCallback) {\n      return request;\n    }\n  }\n\n  let message;\n\n  try {\n    message = JSON.stringify(request, this.options.replacer);\n  } catch (err) {\n    return callback(err);\n  }\n\n  this.callServer(message, function (err, response) {\n    self._parseResponse(err, response, callback);\n  }); // always return the raw request\n\n  return request;\n};\n/**\n * Parses a response from a server\n * @param {Object} err Error to pass on that is unrelated to the actual response\n * @param {String} responseText JSON-RPC 1.0 or 2.0 response\n * @param {Function} callback Callback that will receive different arguments depending on the amount of parameters\n * @private\n */\n\n\nClientBrowser.prototype._parseResponse = function (err, responseText, callback) {\n  if (err) {\n    callback(err);\n    return;\n  }\n\n  if (!responseText) {\n    // empty response text, assume that is correct because it could be a\n    // notification which jayson does not give any body for\n    return callback();\n  }\n\n  let response;\n\n  try {\n    response = JSON.parse(responseText, this.options.reviver);\n  } catch (err) {\n    return callback(err);\n  }\n\n  if (callback.length === 3) {\n    // if callback length is 3, we split callback arguments on error and response\n    // is batch response?\n    if (Array.isArray(response)) {\n      // neccesary to split strictly on validity according to spec here\n      const isError = function (res) {\n        return typeof res.error !== 'undefined';\n      };\n\n      const isNotError = function (res) {\n        return !isError(res);\n      };\n\n      return callback(null, response.filter(isError), response.filter(isNotError));\n    } else {\n      // split regardless of validity\n      return callback(null, response.error, response.result);\n    }\n  }\n\n  callback(null, response);\n};","map":{"version":3,"names":["uuid","require","v4","generateRequest","ClientBrowser","callServer","options","reviver","replacer","generator","version","notificationIdNull","module","exports","prototype","request","method","params","id","callback","self","isBatch","Array","isArray","TypeError","isRaw","undefined","hasCallback","err","message","JSON","stringify","response","_parseResponse","responseText","parse","length","isError","res","error","isNotError","filter","result"],"sources":["E:/intoweb3/NBlockment/blockment/node_modules/jayson/lib/client/browser/index.js"],"sourcesContent":["'use strict';\n\nconst uuid = require('uuid').v4;\nconst generateRequest = require('../../generateRequest');\n\n/**\n * Constructor for a Jayson Browser Client that does not depend any node.js core libraries\n * @class ClientBrowser\n * @param {Function} callServer Method that calls the server, receives the stringified request and a regular node-style callback\n * @param {Object} [options]\n * @param {Function} [options.reviver] Reviver function for JSON\n * @param {Function} [options.replacer] Replacer function for JSON\n * @param {Number} [options.version=2] JSON-RPC version to use (1|2)\n * @param {Function} [options.generator] Function to use for generating request IDs\n *  @param {Boolean} [options.notificationIdNull=false] When true, version 2 requests will set id to null instead of omitting it\n * @return {ClientBrowser}\n */\nconst ClientBrowser = function(callServer, options) {\n  if(!(this instanceof ClientBrowser)) {\n    return new ClientBrowser(callServer, options);\n  }\n\n  if (!options) {\n    options = {};\n  }\n\n  this.options = {\n    reviver: typeof options.reviver !== 'undefined' ? options.reviver : null,\n    replacer: typeof options.replacer !== 'undefined' ? options.replacer : null,\n    generator: typeof options.generator !== 'undefined' ? options.generator : function() { return uuid(); },\n    version: typeof options.version !== 'undefined' ? options.version : 2,\n    notificationIdNull: typeof options.notificationIdNull === 'boolean' ? options.notificationIdNull : false,\n  };\n\n  this.callServer = callServer;\n};\n\nmodule.exports = ClientBrowser;\n\n/**\n *  Creates a request and dispatches it if given a callback.\n *  @param {String|Array} method A batch request if passed an Array, or a method name if passed a String\n *  @param {Array|Object} [params] Parameters for the method\n *  @param {String|Number} [id] Optional id. If undefined an id will be generated. If null it creates a notification request\n *  @param {Function} [callback] Request callback. If specified, executes the request rather than only returning it.\n *  @throws {TypeError} Invalid parameters\n *  @return {Object} JSON-RPC 1.0 or 2.0 compatible request\n */\nClientBrowser.prototype.request = function(method, params, id, callback) {\n  const self = this;\n  let request = null;\n\n  // is this a batch request?\n  const isBatch = Array.isArray(method) && typeof params === 'function';\n\n  if (this.options.version === 1 && isBatch) {\n    throw new TypeError('JSON-RPC 1.0 does not support batching');\n  }\n\n  // is this a raw request?\n  const isRaw = !isBatch && method && typeof method === 'object' && typeof params === 'function';\n\n  if(isBatch || isRaw) {\n    callback = params;\n    request = method;\n  } else {\n    if(typeof id === 'function') {\n      callback = id;\n      // specifically undefined because \"null\" is a notification request\n      id = undefined;\n    }\n\n    const hasCallback = typeof callback === 'function';\n\n    try {\n      request = generateRequest(method, params, id, {\n        generator: this.options.generator,\n        version: this.options.version,\n        notificationIdNull: this.options.notificationIdNull,\n      });\n    } catch(err) {\n      if(hasCallback) {\n        return callback(err);\n      }\n      throw err;\n    }\n\n    // no callback means we should just return a raw request\n    if(!hasCallback) {\n      return request;\n    }\n\n  }\n\n  let message;\n  try {\n    message = JSON.stringify(request, this.options.replacer);\n  } catch(err) {\n    return callback(err);\n  }\n\n  this.callServer(message, function(err, response) {\n    self._parseResponse(err, response, callback);\n  });\n\n  // always return the raw request\n  return request;\n};\n\n/**\n * Parses a response from a server\n * @param {Object} err Error to pass on that is unrelated to the actual response\n * @param {String} responseText JSON-RPC 1.0 or 2.0 response\n * @param {Function} callback Callback that will receive different arguments depending on the amount of parameters\n * @private\n */\nClientBrowser.prototype._parseResponse = function(err, responseText, callback) {\n  if(err) {\n    callback(err);\n    return;\n  }\n\n  if(!responseText) {\n    // empty response text, assume that is correct because it could be a\n    // notification which jayson does not give any body for\n    return callback();\n  }\n\n  let response;\n  try {\n    response = JSON.parse(responseText, this.options.reviver);\n  } catch(err) {\n    return callback(err);\n  }\n\n  if(callback.length === 3) {\n    // if callback length is 3, we split callback arguments on error and response\n\n    // is batch response?\n    if(Array.isArray(response)) {\n\n      // neccesary to split strictly on validity according to spec here\n      const isError = function(res) {\n        return typeof res.error !== 'undefined';\n      };\n\n      const isNotError = function (res) {\n        return !isError(res);\n      };\n\n      return callback(null, response.filter(isError), response.filter(isNotError));\n    \n    } else {\n\n      // split regardless of validity\n      return callback(null, response.error, response.result);\n    \n    }\n  \n  }\n\n  callback(null, response);\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}