{"ast":null,"code":"import isNode from 'detect-node';\nimport BrowserMethod from './browser.js';\nimport NodeMethod from './node.js';\nvar USE_METHOD = isNode ? NodeMethod : BrowserMethod;\nvar LISTENERS = new Set();\nvar startedListening = false;\n\nfunction startListening() {\n  if (startedListening) return;\n  startedListening = true;\n  USE_METHOD.add(runAll);\n}\n\nexport function add(fn) {\n  startListening();\n  if (typeof fn !== 'function') throw new Error('Listener is no function');\n  LISTENERS.add(fn);\n  var addReturn = {\n    remove: function remove() {\n      return LISTENERS[\"delete\"](fn);\n    },\n    run: function run() {\n      LISTENERS[\"delete\"](fn);\n      return fn();\n    }\n  };\n  return addReturn;\n}\nexport function runAll() {\n  var promises = [];\n  LISTENERS.forEach(function (fn) {\n    promises.push(fn());\n    LISTENERS[\"delete\"](fn);\n  });\n  return Promise.all(promises);\n}\nexport function removeAll() {\n  LISTENERS.clear();\n}\nexport function getSize() {\n  return LISTENERS.size;\n}","map":{"version":3,"names":["isNode","BrowserMethod","NodeMethod","USE_METHOD","LISTENERS","Set","startedListening","startListening","add","runAll","fn","Error","addReturn","remove","run","promises","forEach","push","Promise","all","removeAll","clear","getSize","size"],"sources":["E:/intoweb3/NBlockment/blockment/node_modules/unload/dist/es/index.js"],"sourcesContent":["import isNode from 'detect-node';\nimport BrowserMethod from './browser.js';\nimport NodeMethod from './node.js';\nvar USE_METHOD = isNode ? NodeMethod : BrowserMethod;\nvar LISTENERS = new Set();\nvar startedListening = false;\n\nfunction startListening() {\n  if (startedListening) return;\n  startedListening = true;\n  USE_METHOD.add(runAll);\n}\n\nexport function add(fn) {\n  startListening();\n  if (typeof fn !== 'function') throw new Error('Listener is no function');\n  LISTENERS.add(fn);\n  var addReturn = {\n    remove: function remove() {\n      return LISTENERS[\"delete\"](fn);\n    },\n    run: function run() {\n      LISTENERS[\"delete\"](fn);\n      return fn();\n    }\n  };\n  return addReturn;\n}\nexport function runAll() {\n  var promises = [];\n  LISTENERS.forEach(function (fn) {\n    promises.push(fn());\n    LISTENERS[\"delete\"](fn);\n  });\n  return Promise.all(promises);\n}\nexport function removeAll() {\n  LISTENERS.clear();\n}\nexport function getSize() {\n  return LISTENERS.size;\n}"],"mappings":"AAAA,OAAOA,MAAP,MAAmB,aAAnB;AACA,OAAOC,aAAP,MAA0B,cAA1B;AACA,OAAOC,UAAP,MAAuB,WAAvB;AACA,IAAIC,UAAU,GAAGH,MAAM,GAAGE,UAAH,GAAgBD,aAAvC;AACA,IAAIG,SAAS,GAAG,IAAIC,GAAJ,EAAhB;AACA,IAAIC,gBAAgB,GAAG,KAAvB;;AAEA,SAASC,cAAT,GAA0B;EACxB,IAAID,gBAAJ,EAAsB;EACtBA,gBAAgB,GAAG,IAAnB;EACAH,UAAU,CAACK,GAAX,CAAeC,MAAf;AACD;;AAED,OAAO,SAASD,GAAT,CAAaE,EAAb,EAAiB;EACtBH,cAAc;EACd,IAAI,OAAOG,EAAP,KAAc,UAAlB,EAA8B,MAAM,IAAIC,KAAJ,CAAU,yBAAV,CAAN;EAC9BP,SAAS,CAACI,GAAV,CAAcE,EAAd;EACA,IAAIE,SAAS,GAAG;IACdC,MAAM,EAAE,SAASA,MAAT,GAAkB;MACxB,OAAOT,SAAS,CAAC,QAAD,CAAT,CAAoBM,EAApB,CAAP;IACD,CAHa;IAIdI,GAAG,EAAE,SAASA,GAAT,GAAe;MAClBV,SAAS,CAAC,QAAD,CAAT,CAAoBM,EAApB;MACA,OAAOA,EAAE,EAAT;IACD;EAPa,CAAhB;EASA,OAAOE,SAAP;AACD;AACD,OAAO,SAASH,MAAT,GAAkB;EACvB,IAAIM,QAAQ,GAAG,EAAf;EACAX,SAAS,CAACY,OAAV,CAAkB,UAAUN,EAAV,EAAc;IAC9BK,QAAQ,CAACE,IAAT,CAAcP,EAAE,EAAhB;IACAN,SAAS,CAAC,QAAD,CAAT,CAAoBM,EAApB;EACD,CAHD;EAIA,OAAOQ,OAAO,CAACC,GAAR,CAAYJ,QAAZ,CAAP;AACD;AACD,OAAO,SAASK,SAAT,GAAqB;EAC1BhB,SAAS,CAACiB,KAAV;AACD;AACD,OAAO,SAASC,OAAT,GAAmB;EACxB,OAAOlB,SAAS,CAACmB,IAAjB;AACD"},"metadata":{},"sourceType":"module"}